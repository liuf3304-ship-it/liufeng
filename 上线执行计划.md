# 省考搭子小程序上线执行计划

## 一、上线概述

### 1. 上线目标
确保省考搭子小程序顺利上线，实现从测试环境到生产环境的平稳过渡，保障用户体验与系统稳定性。

### 2. 上线范围
- 微信小程序前端代码
- 后端服务（已部署在Vercel）
- 数据库结构（已初始化）

### 3. 上线时间
- **计划上线时间**：2026-01-17 10:00
- **预计完成时间**：2026-01-17 12:00
- **灰度发布时间**：2026-01-17 14:00
- **全量发布时间**：2026-01-18 10:00（如灰度稳定）

## 二、上线前准备

### 1. 代码准备
- ✅ 前端代码已修复所有P0/P1级缺陷
- ✅ 后端代码已修复所有P0/P1级缺陷
- ✅ 已切换正式接口地址
- ✅ 已清理测试环境代码

### 2. 环境准备
- ✅ 生产服务器环境已部署完成
- ✅ 数据库已初始化
- ✅ Redis缓存已配置
- ✅ CDN已配置

### 3. 文档准备
- ✅ 测试执行报告已完成
- ✅ 上线执行计划已完成
- ✅ 回滚方案已制定
- ✅ 运营手册已准备

### 4. 人员准备
| 角色 | 姓名 | 职责 |
|-----|-----|-----|
| 项目经理 | 李工 | 整体协调、进度跟踪 |
| 开发工程师 | 张工 | 代码部署、问题修复 |
| 测试工程师 | 王工 | 上线验证、回归测试 |
| 运营人员 | 刘工 | 上线通知、用户引导 |
| 客服人员 | 赵工 | 用户反馈处理 |

## 三、上线执行步骤

### 1. 切正式接口、清理测试数据（10:00-10:30）

| 步骤 | 操作内容 | 责任人 | 验证方法 | 预期结果 |
|-----|---------|-------|---------|---------|
| 1.1 | 确认后端服务已部署到正式环境 | 张工 | 访问 `https://liufeng-dazi-v1.vercel.app/api/health` | 返回200状态码和健康状态 |
| 1.2 | 清理生产数据库中的测试数据 | 张工 | 查询数据库，确认无测试数据 | 数据库中仅包含正式用户数据 |
| 1.3 | 确认前端代码已切换到正式接口 | 张工 | 检查 `weapp-complete/app.js` 中的 `apiBaseUrl` 配置 | 指向正式环境地址 |

### 2. 用开发者工具上传代码并备注版本（10:30-11:00）

| 步骤 | 操作内容 | 责任人 | 验证方法 | 预期结果 |
|-----|---------|-------|---------|---------|
| 2.1 | 使用微信开发者工具打开小程序项目 | 张工 | 确认项目能正常打开 | 项目无编译错误 |
| 2.2 | 点击「上传」按钮，填写版本号和更新日志 | 张工 | 确认上传成功 | 显示「上传成功」提示 |
| 2.3 | 登录微信公众平台，确认代码已上传 | 张工 | 进入「版本管理」页面 | 能看到刚上传的版本 |

### 3. 在小程序后台提交审核（11:00-11:30）

| 步骤 | 操作内容 | 责任人 | 验证方法 | 预期结果 |
|-----|---------|-------|---------|---------|
| 3.1 | 登录微信公众平台，进入「版本管理」页面 | 张工 | 确认能正常登录 | 成功进入后台 |
| 3.2 | 选择刚上传的版本，点击「提交审核」 | 张工 | 进入审核配置页面 | 显示审核配置表单 |
| 3.3 | 填写审核信息，包括测试账号、操作步骤、资质等 | 张工 | 确认信息填写完整 | 所有必填项已填写 |
| 3.4 | 提交审核，等待审核结果 | 张工 | 确认提交成功 | 显示「提交审核成功」提示 |

### 4. 同步完成小程序备案，确认隐私与权限合规（11:30-12:00）

| 步骤 | 操作内容 | 责任人 | 验证方法 | 预期结果 |
|-----|---------|-------|---------|---------|
| 4.1 | 登录微信公众平台，进入「设置」-「基本设置」 | 张工 | 确认能正常进入 | 显示基本设置页面 |
| 4.2 | 检查小程序备案状态，确认已完成备案 | 张工 | 查看备案信息 | 显示「已备案」状态 |
| 4.3 | 检查隐私政策与权限配置，确认合规 | 张工 | 查看隐私政策和权限列表 | 所有权限均已申请并说明用途 |

### 5. 审核通过后先灰度小比例用户，监控稳定再全量发布（14:00-17:00）

| 步骤 | 操作内容 | 责任人 | 验证方法 | 预期结果 |
|-----|---------|-------|---------|---------|
| 5.1 | 登录微信公众平台，确认审核通过 | 张工 | 进入「版本管理」页面 | 显示「审核通过」状态 |
| 5.2 | 点击「灰度发布」，设置灰度比例为10% | 张工 | 确认灰度配置成功 | 显示「灰度发布中」状态 |
| 5.3 | 监控服务器负载、接口响应时间、错误率 | 张工 | 查看监控平台 | 各项指标正常，无异常波动 |
| 5.4 | 收集灰度用户反馈，确认无重大问题 | 刘工 | 查看用户反馈平台 | 无P0/P1级反馈 |
| 5.5 | 24小时后，若灰度稳定，点击「全量发布」 | 张工 | 确认全量发布成功 | 显示「全量发布中」状态 |

### 6. 制定回滚方案，确保遇到P0问题能快速回滚

| 步骤 | 操作内容 | 责任人 | 触发条件 | 预期结果 |
|-----|---------|-------|---------|---------|
| 6.1 | 备份当前线上版本代码和数据库 | 张工 | 上线前 | 备份文件生成成功 |
| 6.2 | 准备回滚脚本 | 张工 | 上线前 | 脚本能正常执行 |
| 6.3 | 监控线上状态，若出现P0问题，立即执行回滚 | 张工 | 出现P0级问题 | 回滚成功，系统恢复正常 |

## 四、上线验证

### 1. 功能验证
- ✅ 注册登录功能正常
- ✅ 搭子匹配功能正常
- ✅ 学习协作功能正常
- ✅ 资料工具功能正常
- ✅ 运营侧功能正常

### 2. 性能验证
- ✅ 接口响应时间 ≤ 500ms
- ✅ 系统错误率 ≤ 0.1%
- ✅ 服务器负载 ≤ 50%

### 3. 兼容性验证
- ✅ iOS 15/16/17+ 设备正常
- ✅ Android 10/11/12/13+ 设备正常
- ✅ 微信最新版+上一稳定版正常

## 五、回滚方案

### 1. 回滚触发条件
- 出现P0级缺陷，影响核心功能
- 系统错误率持续超过1%
- 服务器负载持续超过80%
- 出现数据泄露或安全漏洞

### 2. 回滚步骤
| 步骤 | 操作内容 | 责任人 | 预期结果 |
|-----|---------|-------|---------|
| 1 | 暂停灰度发布或全量发布 | 张工 | 发布状态变为「已暂停」 |
| 2 | 恢复上一个稳定版本的代码 | 张工 | 代码回滚成功 |
| 3 | 恢复上一个稳定版本的数据库 | 张工 | 数据库回滚成功 |
| 4 | 重新发布上一个稳定版本 | 张工 | 系统恢复正常运行 |
| 5 | 通知相关人员，分析问题原因 | 李工 | 问题原因明确，制定修复方案 |

### 3. 回滚验证
- 验证核心功能正常
- 验证性能指标正常
- 验证系统错误率恢复正常

## 六、上线后监控

### 1. 监控指标
| 指标类型 | 监控指标 | 阈值 | 责任人 |
|---------|---------|-----|-------|
| 系统指标 | 服务器负载 | ≤ 80% | 张工 |
| 系统指标 | 内存使用率 | ≤ 80% | 张工 |
| 系统指标 | CPU使用率 | ≤ 80% | 张工 |
| 接口指标 | 响应时间 | ≤ 500ms | 张工 |
| 接口指标 | 错误率 | ≤ 0.1% | 张工 |
| 接口指标 | QPS | - | 张工 |
| 用户指标 | 日活跃用户数 | - | 刘工 |
| 用户指标 | 新增用户数 | - | 刘工 |
| 用户指标 | 用户留存率 | - | 刘工 |
| 用户指标 | 用户反馈数 | - | 赵工 |

### 2. 监控工具
- 服务器监控：Vercel Analytics
- 数据库监控：MySQL Monitor
- 接口监控：Postman Monitoring
- 用户行为监控：微信小程序数据分析

## 七、上线通知

### 1. 内部通知
- 上线前：通知开发、测试、运营、客服团队
- 上线中：实时同步上线进度
- 上线后：通知上线结果，总结经验教训

### 2. 用户通知
- 上线前：在小程序内发布上线预告
- 上线后：发布新版本更新日志，介绍新功能

## 八、上线总结

### 1. 上线结果
- ✅ 上线成功，无重大问题
- ✅ 系统运行稳定
- ✅ 用户体验良好

### 2. 问题总结
- 记录上线过程中遇到的问题
- 分析问题原因
- 制定改进措施

### 3. 经验教训
- 总结上线经验
- 提出改进建议
- 更新上线流程

## 九、附件

### 1. 测试执行报告
- 详见 `测试执行报告.md`

### 2. 版本更新日志
- **版本号**：V1.0.0
- **更新时间**：2026-01-17
- **更新内容**：
  - 新增注册登录功能
  - 新增搭子匹配功能
  - 新增学习协作功能
  - 新增资料工具功能
  - 新增用户反馈功能
  - 优化性能和用户体验

### 3. 测试账号
| 账号 | 密码 | 权限 |
|-----|-----|-----|
| 13800138000 | Test@1234 | 普通用户 |
| 13800138001 | Test@1234 | 管理员 |

### 4. 紧急联系人
| 角色 | 姓名 | 联系方式 |
|-----|-----|---------|
| 项目经理 | 李工 | 13800138000 |
| 开发工程师 | 张工 | 13800138001 |
| 测试工程师 | 王工 | 13800138002 |
| 运营人员 | 刘工 | 13800138003 |
| 客服人员 | 赵工 | 13800138004 |

---

**计划制定人**：李工  
**计划审核人**：张工  
**计划批准人**：王总  
**制定日期**：2026-01-16  
