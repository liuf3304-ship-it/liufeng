<!-- errorSquare.wxml -->
<view class="container">
  <!-- 页面标题 -->
  <view class="page-header">
    <text class="page-title">共享错题广场</text>
    <button class="btn btn-secondary" bindtap="goToErrorBook">
      <text class="btn-text">我的错题本</text>
    </button>
  </view>

  <!-- 薄弱模块筛选栏 -->
  <view class="filter-section">
    <text class="filter-label">薄弱模块：</text>
    <view class="module-tabs">
      <view 
        class="module-tab {{selectedModule === '' ? 'active' : ''}}" 
        bindtap="onModuleChange" 
        data-module=""
      >
        <text class="tab-text">全部</text>
      </view>
      <view 
        class="module-tab {{selectedModule === item ? 'active' : ''}}" 
        wx:for="{{weakModules}}" 
        wx:key="item" 
        bindtap="onModuleChange" 
        data-module="{{item}}"
      >
        <text class="tab-text">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- 错题列表 -->
  <view class="error-list">
    <!-- 加载中 -->
    <view wx:if="{{isLoading && errorQuestions.length === 0}}" class="loading-container">
      <text class="loading-text">加载中...</text>
    </view>

    <!-- 空状态 -->
    <view wx:elif="{{!isLoading && errorQuestions.length === 0}}" class="empty-container">
      <text class="empty-text">还没有共享错题，快来成为第一个分享者吧</text>
    </view>

    <!-- 错题列表 -->
    <view wx:else class="error-items">
      <view class="error-item card" wx:for="{{errorQuestions}}" wx:key="id" bindtap="goToQuestionDetail" data-id="{{item.id}}">
        <!-- 分享者信息 -->
        <view class="user-info">
          <image 
            class="user-avatar" 
            src="{{item.User.avatar || '/assets/images/default-avatar.png'}}" 
            mode="aspectFill"
          ></image>
          <text class="user-nickname">{{item.User.nickname || '匿名用户'}}</text>
        </view>
        
        <!-- 错题内容 -->
        <view class="question-content">
          <text class="question-text">{{item.questionContent.substring(0, 120)}}{{item.questionContent.length > 120 ? '...' : ''}}</text>
        </view>

        <!-- 错题信息 -->
        <view class="question-info">
          <view class="info-row">
            <text class="info-label">考点：</text>
            <text class="info-value">{{item.考点 || '未填写'}}</text>
          </view>
          <view class="info-row">
            <text class="info-label">薄弱模块：</text>
            <text class="info-value">{{item.weakModule || '未分类'}}</text>
          </view>
          <view class="info-row">
            <text class="info-label">正确率：</text>
            <text class="info-value">{{item.correctRate ? (item.correctRate * 100).toFixed(1) + '%' : '未知'}}</text>
          </view>
        </view>

        <!-- 操作按钮 -->
        <view class="question-actions">
          <button class="action-btn {{item.isCollected ? 'collected' : ''}}" bindtap="collectQuestion" data-id="{{item.id}}" data-collected="{{item.isCollected}}">
            <text class="action-icon">{{item.isCollected ? '★' : '☆'}}</text>
            <text class="action-text">{{item.isCollected ? '已收藏' : '收藏'}}</text>
          </button>
        </view>
      </view>

      <!-- 加载更多 -->
      <view wx:if="{{hasMore}}" class="load-more" bindtap="loadMoreQuestions">
        <text class="load-more-text">加载更多</text>
      </view>
    </view>
  </view>
</view>